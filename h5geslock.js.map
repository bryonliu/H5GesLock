{"version":3,"sources":["index.js"],"names":[],"mappings":"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","file":"h5geslock.js","sourcesContent":["/**\r\n * Created by bryonliu on 2016/8/15.\r\n */\r\n\r\n/***\r\n * option={\r\n *     width : 宽度，建议使用默认的屏幕宽度\r\n *     height : 高度\r\n *     R      : 大圆的半径\r\n *     R_INNER: 选中之后内圆的半径\r\n *     dy     : 维度（N*N），默认是3\r\n *     offsetX: 左右留白\r\n *     offsetY:上下留白\r\n *     lineWidthNormal : 绘制大圆的线宽\r\n *     lineWidthTouched：绘制触摸点连接线的线宽\r\n *\r\n *     colorNormal ： 正常情况下绘制大圆的边框颜色\r\n *     colorNormalTouched：选中情况下绘制连接线的颜色\r\n *     colorNormalTouchedFill ：选中情况下绘制大圆的填充色\r\n *     colorWarnTouched ：警告情况下连接线的颜色\r\n *     colorWarnTouchedFill： 警告情况下选中点的大圆填充色\r\n *\r\n *     inputEnd： 输入一次之后的回调函数参数｛pwd｝\r\n * }\r\n *     H5GesLock 对外方法：\r\n *     init:初始化\r\n *     drawWarn ： 绘制上次的告警样式\r\n *\r\n */\r\nclass H5GesLock {\r\n\r\n    constructor(options) {\r\n        options = options || {};\r\n        this.inputEnd = options.inputEnd;\r\n        this.width = options.width || document.body.offsetWidth;\r\n        this.height = options.height || this.width;\r\n        this.R = options.R || this.width * 0.17 / 2;\r\n        this.R_INNER = this.R * 0.3;      //选中之后内圆的半径\r\n        this.dy = options.type || 3; // 维度 默认是3*3\r\n        this.offsetX = options.offsetX || this.width * 0.145; //触摸点上下和左右的留白\r\n        this.offsetY = options.offsetY || this.width * 0.145;\r\n        this.lineWidthNormal = options.lineWidthNormal || 1.5;\r\n        this.lineWidthTouched = options.lineWidthTouched || 1.5;\r\n\r\n        this.colorNormal = options.colorNormal || \"#CCCCCC\"; // 默认点边框颜色值\r\n        this.colorNormalTouched = options.colorNormalTouched || \"#2D72F1\";  //划线颜色\r\n        this.colorNormalTouchedFill = options.colorNormalTouchedFill || \"#B0C8F3\" // 选择点的填充颜色\r\n        this.colorWarnTouched = options.colorWarnTouched || \"#F95A5A\";  //错误情况下划线颜色\r\n        this.colorWarnTouchedFill = options.colorWarnTouchedFill || \"#F6BFBF\" // 错误情况下的选择点的填充颜色\r\n\r\n        if (!options.container || !document.getElementById(options.container)) {\r\n            throw new Error(\"please input right id of you canvas\");\r\n        }\r\n        this.mContainer = document.getElementById(options.container);\r\n        this.mContext = this.mContainer.getContext(\"2d\");\r\n\r\n        this.mContainer.width = this.width;\r\n        this.mContainer.height = this.height;\r\n\r\n\r\n        this.touchSpots = caculateTouchSpotsLocation(this);  // 屏幕上的所有点\r\n        this.hasTouchedSpots = [];\r\n\r\n        this.touchStartListener = touchStartHandler(this);\r\n        this.touchMoveListenner = touchMoveHandler(this);\r\n        this.touchEndListener = touchEndHandler(this);\r\n\r\n    }\r\n\r\n    init() {\r\n        clear(this);\r\n        this.hasTouchedSpots = [];\r\n        drawDefaultSpots(this);\r\n        bindEvent(this);\r\n    }\r\n\r\n\r\n    drawWarn() {\r\n        clear(this);\r\n        drawWarn(this);\r\n    }\r\n}\r\nwindow.H5GesLock = H5GesLock;\r\n/**\r\n * 计算手势密码的N*N个位置\r\n * 3*3顺序依次为：\r\n *    1 2 3\r\n *    4 5 6\r\n *    7 8 9\r\n */\r\n\r\nfunction clear(h5ges) {\r\n    h5ges.mContext.clearRect(0, 0, h5ges.width, h5ges.height);\r\n}\r\nfunction caculateTouchSpotsLocation(H5Ges) {\r\n    var spots = [];\r\n\r\n    let X_Dis = (H5Ges.width - 2 * H5Ges.offsetX - 2 * H5Ges.R) / (H5Ges.dy - 1); // X 轴上的圆心距\r\n    let Y_Dis = (H5Ges.height - 2 * H5Ges.offsetY - 2 * H5Ges.R) / (H5Ges.dy - 1); // Y 轴上的圆心距\r\n\r\n    for (let row = 0; row < H5Ges.dy; row++) {\r\n        for (let col = 0; col < H5Ges.dy; col++) {\r\n            let point = {\r\n                X: H5Ges.offsetX + H5Ges.R + col * X_Dis,\r\n                Y: H5Ges.offsetY + H5Ges.R + row * Y_Dis\r\n            }\r\n            spots.push(point);\r\n        }\r\n    }\r\n    return spots;\r\n}\r\n\r\nfunction drawNormal(h5ges, lastPoint) {\r\n\r\n    drawDefaultSpots(h5ges);\r\n    drawTouchSpots(h5ges, true);\r\n    drawTouchLine(h5ges, true, lastPoint);\r\n    drawTouchCenter(h5ges, true);\r\n}\r\nfunction drawWarn(h5ges) {\r\n\r\n    drawDefaultSpots(h5ges);\r\n    drawTouchSpots(h5ges, false);\r\n    drawTouchLine(h5ges, false, null);\r\n    drawTouchCenter(h5ges, false);\r\n}\r\n/**\r\n * 选择点颜色填充\r\n * @param h5ges\r\n * @param isNormal 是正常选中还是警告\r\n */\r\nfunction drawTouchSpots(h5ges, isNormal) {\r\n    var mContext = h5ges.mContext;\r\n    h5ges.hasTouchedSpots.forEach(function (spotIndex) {\r\n        var spot = h5ges.touchSpots[spotIndex];\r\n        var color = isNormal ? h5ges.colorNormalTouchedFill : h5ges.colorWarnTouchedFill;\r\n        mContext.beginPath();\r\n        mContext.strokeStyle = color;\r\n        mContext.fillStyle = color;\r\n        mContext.arc(spot.X, spot.Y, h5ges.R, 0, Math.PI * 2);\r\n        mContext.fill();\r\n        mContext.closePath();\r\n        mContext.stroke();\r\n\r\n    });\r\n}\r\n/***\r\n *  绘初始化默认图\r\n * @param h5ges\r\n */\r\nfunction drawDefaultSpots(h5ges) {\r\n\r\n    var mContext = h5ges.mContext;\r\n    h5ges.touchSpots.forEach(function (spot) {\r\n        mContext.beginPath();\r\n        mContext.lineWidth = h5ges.lineWidthNormal;\r\n        mContext.strokeStyle = h5ges.colorNormal;\r\n        mContext.arc(spot.X, spot.Y, h5ges.R, 0, Math.PI * 2);\r\n        mContext.closePath();\r\n        mContext.stroke();\r\n    });\r\n}\r\n\r\n/**\r\n * 绘制以选择点的中间小圆\r\n * @param mContext\r\n * @param touchSpots\r\n * @param color\r\n * @param allSpots\r\n */\r\nfunction drawTouchCenter(h5ges, isNormal) {\r\n    var mContext = h5ges.mContext;\r\n    h5ges.hasTouchedSpots.forEach(function (spotIndex) {\r\n        var spot = h5ges.touchSpots[spotIndex];\r\n        mContext.beginPath();\r\n        mContext.lineWidth = 1;\r\n        mContext.fillStyle = isNormal ? h5ges.colorNormalTouched : h5ges.colorWarnTouched;\r\n        mContext.arc(spot.X, spot.Y, h5ges.R_INNER, 0, Math.PI * 2);\r\n        mContext.fill();\r\n        mContext.closePath();\r\n        mContext.stroke();\r\n\r\n    });\r\n}\r\n/**\r\n * 绘制一选择点以及当前触摸点的连线\r\n * @param h5ges\r\n * @param color\r\n * @param lastPoint\r\n */\r\nfunction drawTouchLine(h5ges, isNormal, lastPoint) {\r\n\r\n    var touchSpots = h5ges.hasTouchedSpots;\r\n\r\n    if (!touchSpots || touchSpots.length == 0) return;\r\n    h5ges.mContext.beginPath();\r\n    touchSpots.forEach(function (spot) {\r\n        h5ges.mContext.lineTo(h5ges.touchSpots[spot].X, h5ges.touchSpots[spot].Y);\r\n    });\r\n    h5ges.mContext.lineWidth = h5ges.lineWidthTouched;\r\n    h5ges.mContext.strokeStyle = isNormal ? h5ges.colorNormalTouched : h5ges.colorWarnTouched;\r\n    h5ges.mContext.stroke();\r\n    h5ges.mContext.closePath();\r\n    var mContext = h5ges.mContext;\r\n\r\n    if (lastPoint != null) {\r\n        let lastTouchSpotIndex = touchSpots[touchSpots.length - 1];\r\n        let lastSpot = h5ges.touchSpots[lastTouchSpotIndex];\r\n        mContext.beginPath();\r\n        mContext.moveTo(lastSpot.X, lastSpot.Y);\r\n        mContext.lineTo(lastPoint.X, lastPoint.Y);\r\n        mContext.stroke();\r\n        mContext.closePath();\r\n    }\r\n\r\n}\r\nfunction bindEvent(h5Ges) {\r\n\r\n    h5Ges.mContainer.addEventListener(\"touchstart\", h5Ges.touchStartListener, false);\r\n    h5Ges.mContainer.addEventListener(\"touchmove\", h5Ges.touchMoveListenner, false);\r\n    h5Ges.mContainer.addEventListener(\"touchend\", h5Ges.touchEndListener, false);\r\n}\r\nvar touchStartHandler = function (h5Ges) {\r\n    return function (e) {\r\n        let touche = e.touches[0];\r\n        var touchPoint =getTouchCoordinateOFElement(h5Ges,touche);\r\n        isTouchSpot(h5Ges, touchPoint);\r\n    };\r\n}\r\n\r\nvar touchMoveHandler = function (h5Ges) {\r\n    return function (e) {\r\n        e.preventDefault();\r\n        var touche = e.touches[0];\r\n        var touchPoint =getTouchCoordinateOFElement(h5Ges,touche);\r\n        var istouch = isTouchSpot(h5Ges, touchPoint);\r\n        pickSpotsOnLine(h5Ges.hasTouchedSpots, h5Ges.dy);\r\n        clear(h5Ges);\r\n        let lastPoint = istouch ? null : touchPoint;\r\n        drawNormal(h5Ges, lastPoint);\r\n    };\r\n}\r\n\r\nvar touchEndHandler = function (h5Ges) {\r\n    return function (e) {\r\n        clear(h5Ges);\r\n        drawNormal(h5Ges, h5Ges.hasTouchedSpots);\r\n        h5Ges.lastTouchSpots = h5Ges.hasTouchedSpots;\r\n\r\n        if (h5Ges.inputEnd && typeof h5Ges.inputEnd == \"function\") {\r\n            h5Ges.inputEnd(h5Ges.hasTouchedSpots.join(\"\"));\r\n        } else {\r\n            console.log(h5Ges.hasTouchedSpots.join(\"\"));\r\n        }\r\n        h5Ges.hasTouchedSpots = [];\r\n        unbindEvent(h5Ges);\r\n    };\r\n}\r\n\r\nfunction unbindEvent(h5Ges) {\r\n    var mContainer = h5Ges.mContainer;\r\n    mContainer.removeEventListener(\"touchstart\", h5Ges.touchStartListener, false);\r\n    mContainer.removeEventListener(\"touchmove\", h5Ges.touchMoveListenner, false);\r\n    mContainer.removeEventListener(\"touchend\", h5Ges.touchEndListener, false);\r\n}\r\n/**\r\n * @brify 判断是否触摸到某个点以及是否已经被触摸过\r\n * @param h5ges\r\n * @param currentSpot\r\n * @returns {*|boolean}\r\n */\r\nfunction isTouchSpot(h5ges, currentSpot) {\r\n    return h5ges.touchSpots.some(function (spot, index) {\r\n        let xDiff = spot.X - currentSpot.X;\r\n        let yDiff = spot.Y - currentSpot.Y;\r\n        var dir = Math.pow((xDiff * xDiff + yDiff * yDiff), 0.5);\r\n        if (dir < h5ges.R & h5ges.hasTouchedSpots.indexOf(index) < 0) {\r\n            h5ges.hasTouchedSpots.push(index);\r\n            return true;\r\n        }\r\n    });\r\n}\r\n/**\r\n * 检查任意相邻两点直接是否有其他点，如果有者插入他们中间\r\n * @param touchedSpots\r\n * @param d\r\n */\r\nfunction pickSpotsOnLine(touchedSpots, d) {\r\n\r\n    for (let i = 0; i < touchedSpots.length - 1; i++) {\r\n\r\n        var nums = numberOntheLineOf(touchedSpots[i], touchedSpots[i + 1], d)\r\n        var last = i + 1;\r\n        for (let k = 0; k < nums.length; k++) {\r\n            if (touchedSpots.indexOf(nums[k]) == -1) {\r\n                //console.log(\"has\")\r\n                touchedSpots.splice(last, 0, nums[k]);\r\n                last += 1;\r\n            }\r\n        }\r\n    }\r\n}\r\n/***\r\n * @brify 判断两个相连的数字在d*d宫格中的连线上是否有其他数字， 比如在九宫格中，0，2之间会有1\r\n * @param i 数字i\r\n * @param j 数字j\r\n * @param d 维度d(3*3,4*4)\r\n * @returns {Array}\r\n */\r\nfunction numberOntheLineOf(i, j, d) {\r\n    var result = [];\r\n    if (i > j) {\r\n        var t = i;\r\n        i = j;\r\n        j = t;\r\n    }\r\n    var ix = i % d, iy = parseInt(i / d);\r\n    var jx = j % d, jy = parseInt(j / d);\r\n\r\n\r\n    var dx = jx - ix, dy = jy - iy;\r\n\r\n    if (dx != dy && dx != 0 && dy != 0) return result;\r\n\r\n    //console.log(\"dx : dy = \" + dx + \" : \" + dy);\r\n    if (dx == dy) {\r\n        var begin = d + 1 + i;\r\n        while (begin < j) {\r\n            result.push(begin);\r\n            console.log(begin);\r\n            begin += (d + 1);\r\n        }\r\n    } else if (dx == 0) {\r\n        var begin = i + d;\r\n        while (begin < j) {\r\n            result.push(begin);\r\n            begin += d;\r\n        }\r\n\r\n    } else if (dy == 0) {\r\n\r\n        var begin = i + 1;\r\n\r\n        while (begin < j) {\r\n            result.push(begin);\r\n            begin += 1;\r\n        }\r\n    }\r\n    return result;\r\n}\r\nfunction getTouchCoordinateOFElement(h5ges, touche) {\r\n    var result = {};\r\n    var eleCo = getEleCoordinateOfPage(h5ges.mContainer);\r\n    result.X = touche.pageX - eleCo.pageX;\r\n    result.Y = touche.pageY - eleCo.pageY;\r\n    return result;\r\n}\r\nfunction getEleCoordinateOfPage(ele) {\r\n    var offsetLeft = ele.offsetLeft;\r\n    var offsetTop = ele.offsetTop;\r\n    if (ele.offsetParent !== null) {\r\n        var parCo = getEleCoordinateOfPage(ele.offsetParent);\r\n        offsetLeft += parCo.pageX;\r\n        offsetTop += parCo.pageY;\r\n    }\r\n    return {pageX: offsetLeft, pageY: offsetTop};\r\n}"]}